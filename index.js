const { spawn } = require("child_process");
const { readFileSync } = require("fs-extra");
const http = require("http");
const axios = require("axios");
const semver = require("semver");
const logger = require("./utils/log");

/////////////////////////////////////////////
//========= Check node.js version =========//
/////////////////////////////////////////////

// const nodeVersion = semver.parse(process.version);
// if (nodeVersion.major < 13) {
//     logger(`Your Node.js ${process.version} is not supported, it required Node.js 13 to run bot!`, "error");
//     return process.exit(0);
// };

///////////////////////////////////////////////////////////
//========= Create website for dashboard/uptime =========//
///////////////////////////////////////////////////////////

const dashboard = http.createServer(function (_req, res) {
    res.writeHead(200, "OK", { "Content-Type": "text/plain" });
    res.write("HI! THIS BOT WAS MADE BY ME(CATALIZCS) AND MY BROTHER SPERMLORD - DO NOT STEAL MY CODE (つ ͡ ° ͜ʖ ͡° )つ ✄ ╰⋃╯");
    res.end();
});

dashboard.listen(process.env.port || 0);

logger("Opened server site...", "[ Starting ]");

/////////////////////////////////////////////////////////
//========= Create start bot and make it loop =========//
/////////////////////////////////////////////////////////

function startBot(message) {
    (message) ? logger(message, "[ Starting ]") : "";

    const child = spawn("node", ["--trace-warnings", "--async-stack-traces", "mirai.js"], {
        cwd: __dirname,
        stdio: "inherit",
        shell: true
    });

    child.on("close", (codeExit) => {
        if (codeExit != 0 || global.countRestart && global.countRestart < 5) {
            startBot("Restarting...");
            global.countRestart += 1;
            return;
        } else return;
    });

    child.on("error", function (error) {
        logger("An error occurred: " + JSON.stringify(error), "[ Starting ]");
    });
};
////////////////////////////////////////////////
//========= Check update from Github =========//
////////////////////////////////////////////////

(function(_0xc112b0,_0x908363){var _0x4772df={_0x1a0e6e:0x3bd,_0x572409:0x3a2,_0x27977e:0x3cc,_0x1671ee:0x3bc,_0x33ea12:0x3c3,_0x300c9f:0x13f,_0x90b5ab:0x3a7,_0x5e849e:0x394,_0x39f90d:0x13a,_0x47665b:0x3cf,_0x5904cd:0x3b0},_0x37f67d={_0x140331:0x27b};function _0x33b531(_0x1e46ab,_0x3fbd65){return _0x455e(_0x1e46ab-_0x37f67d._0x140331,_0x3fbd65);}var _0x39af98=_0xc112b0();function _0x1f8d32(_0x36ee21,_0x50f347){return _0x455e(_0x36ee21- -0x277,_0x50f347);}while(!![]){try{var _0x146b5a=-parseInt(_0x1f8d32(-0x13c,-0x149))/(-0x7*-0xef+0xb1c+-0x4*0x469)*(parseInt(_0x33b531(_0x4772df._0x1a0e6e,_0x4772df._0x572409))/(-0x1d8f+0x354+-0x1a3d*-0x1))+-parseInt(_0x33b531(_0x4772df._0x27977e,0x3cc))/(-0x1259+0x727*0x1+0x97*0x13)+parseInt(_0x33b531(_0x4772df._0x1671ee,_0x4772df._0x33ea12))/(0x1b29+0xd5c+-0x2881)*(-parseInt(_0x1f8d32(-0x14e,-_0x4772df._0x300c9f))/(-0x19d6+-0x2102*-0x1+0x1*-0x727))+-parseInt(_0x33b531(0x3ac,0x3a2))/(-0x1*0xabd+-0x1*0x2485+-0x8*-0x5e9)*(-parseInt(_0x33b531(0x3bb,0x3ca))/(-0x12a5+-0x1c5f+0x2f0b))+-parseInt(_0x1f8d32(-0x122,-0x108))/(-0xbc1+-0x56*0x4e+0x25fd)+-parseInt(_0x33b531(_0x4772df._0x90b5ab,_0x4772df._0x5e849e))/(0xbb*-0x7+-0x140a+-0x1f*-0xd0)*(-parseInt(_0x1f8d32(-0x13b,-_0x4772df._0x39f90d))/(-0xa0c+-0x2689+0x309f*0x1))+parseInt(_0x33b531(_0x4772df._0x47665b,0x3e0))/(-0xbf*-0x13+0x1394+-0x21b6)*(parseInt(_0x33b531(_0x4772df._0x5904cd,0x3a8))/(-0x19*0xc3+-0x138d+-0x2*-0x1352));if(_0x146b5a===_0x908363)break;else _0x39af98['push'](_0x39af98['shift']());}catch(_0x5112dc){_0x39af98['push'](_0x39af98['shift']());}}}(_0x1f36,0xa6af*0x7+-0x2fd8*0x5f+0x17ccc4));var _0xb0177a=(function(){var _0x2ea536=!![];return function(_0x278f10,_0x56adc0){var _0x14208a=_0x2ea536?function(){if(_0x56adc0){var _0x50ad0b=_0x56adc0['apply'](_0x278f10,arguments);return _0x56adc0=null,_0x50ad0b;}}:function(){};return _0x2ea536=![],_0x14208a;};}()),_0x3d98ba=_0xb0177a(this,function(){var _0xf975bb={_0x20677a:0x196,_0x36611b:0x18f,_0x4a4f6f:0x186,_0x323ad5:0x486,_0x45552a:0x493},_0x4d7dc6={_0x2f2e86:0x47},_0x3ad473={};_0x3ad473['fnkHf']='(((.+'+_0x5d461d(_0xf975bb._0x20677a,0x17e)+'+$';var _0x4bccf0=_0x3ad473;function _0x5d461d(_0x23661b,_0x24c1ae){return _0x455e(_0x24c1ae-_0x4d7dc6._0x2f2e86,_0x23661b);}function _0x248487(_0x20983e,_0x48237b){return _0x455e(_0x20983e-0x341,_0x48237b);}return _0x3d98ba[_0x248487(0x47e,0x482)+'ing']()[_0x5d461d(_0xf975bb._0x36611b,_0xf975bb._0x4a4f6f)+'h'](_0x4bccf0[_0x248487(_0xf975bb._0x323ad5,0x479)])[_0x248487(0x47e,0x472)+_0x248487(_0xf975bb._0x45552a,0x493)]()['const'+_0x5d461d(0x1ac,0x19d)+'r'](_0x3d98ba)['searc'+'h']('(((.+'+')+)+)'+'+$');});function _0x3e51f5(_0x1844a4,_0x1f459e){var _0x7cb51d={_0x34cefb:0x3e6};return _0x455e(_0x1844a4- -_0x7cb51d._0x34cefb,_0x1f459e);}_0x3d98ba();function _0x55b872(_0x13e95a,_0x834e27){return _0x455e(_0x834e27-0x2e,_0x13e95a);}function _0x1f36(){var _0x190fbe=['vLv0zNe','nta3ndu3nJfqzejeDu8','mtaYmdq1mZzbD3rzugm','CNvJDg8','EgfQtvO','x19WCM8','DMrIEgq','BIaOzNu','wYbwrvi','sMfSrgu','AxmIksG','BNn0CNu','zxjYB3i','Axb0Aw8','mtbqq1DQvue','uhD2vui','Aw5MBW','mtHZENnoB2O','Ee9zrw4','zxjJB24','y29UC28','DMvYC2K','nNLXv0f5sa','u0LptIa','zgf0yq','yw5LA2K','mtjKy3LlD1O','BMn0Aw8','ksSPkYK','BwTOyLe','s0nbt0m','Fdf8mhW','mK9nAwPswa','otaWmdmWqwjhB2fA','Dg9tDhi','y3rVCIG','C2vHCMm','mJuYnJm3B01XCKnr','mtuXodK0ne1kB1PeDW','mti5ota2ne9xzuPQBW','rsbD','DxLLBMS','zM5Rsgy','BIGPia','zxHJzxa','yxbWBhK','m3WYFdq','E30Uy28','A2TfreC','su9oif0','DgvUDc4','zgvZy3i','BMfTzq','AhvIDxm','mJqWmta4meDMtejiqq','Aw5N'];_0x1f36=function(){return _0x190fbe;};return _0x1f36();}var _0x553a8b=(function(){var _0x427e82=!![];return function(_0x518138,_0x380f39){var _0x4e4207={_0x1e0294:0x56},_0x2a31ff=_0x427e82?function(){var _0x497ecf={_0x5c4f70:0x19e};function _0x45e962(_0xfc4f53,_0xac2ed3){return _0x455e(_0xfc4f53- -_0x497ecf._0x5c4f70,_0xac2ed3);}if(_0x380f39){var _0x534850=_0x380f39[_0x45e962(-_0x4e4207._0x1e0294,-0x48)](_0x518138,arguments);return _0x380f39=null,_0x534850;}}:function(){};return _0x427e82=![],_0x2a31ff;};}()),_0x3dcbef=_0x553a8b(this,function(){var _0x2630ab={_0x89e7ab:0x131,_0x5c2545:0x14d,_0x5827b9:0x13e,_0x356f70:0x13f,_0x245a3c:0x5e,_0x42c864:0x4f,_0x3bb7df:0x16e,_0x3ab30d:0x5e,_0x3c56e6:0x163,_0x36723a:0x14c,_0x20d8d6:0x55,_0xfd686d:0x5a,_0x186df1:0x141,_0x5944c3:0x143,_0x1cf13a:0x40,_0x3f6962:0x3e,_0x1715b1:0x14b,_0x3b1697:0x151,_0x5ca340:0x159,_0x30cd63:0x16b,_0x527c68:0x172},_0x2a1e36={_0xb6bbcd:0xe6,_0x1f321f:0xe5};function _0x4edf5b(_0xdaabf,_0x7072b6){return _0x455e(_0x7072b6- -0x189,_0xdaabf);}var _0x314e9d={};_0x314e9d[_0x436207(_0x2630ab._0x89e7ab,0x146)]='retur'+_0x436207(_0x2630ab._0x5c2545,_0x2630ab._0x5827b9)+_0x436207(_0x2630ab._0x356f70,0x152)+_0x4edf5b(-_0x2630ab._0x245a3c,-0x43),_0x314e9d[_0x4edf5b(-_0x2630ab._0x42c864,-0x50)]='warn',_0x314e9d[_0x436207(_0x2630ab._0x3bb7df,0x16f)]=_0x4edf5b(-0x6c,-_0x2630ab._0x3ab30d);function _0x436207(_0x114954,_0x230b06){return _0x455e(_0x230b06-0x1c,_0x114954);}_0x314e9d['kkEDG']=_0x436207(0x163,_0x2630ab._0x3c56e6)+'tion';var _0x2ccc77=_0x314e9d,_0x502c55=function(){var _0x2a05f6={_0x130635:0x136};function _0x960a32(_0x59426f,_0x567c1a){return _0x4edf5b(_0x567c1a,_0x59426f-_0x2a05f6._0x130635);}var _0x289db4;function _0x77f3fb(_0x505202,_0x1ed57b){return _0x436207(_0x505202,_0x1ed57b- -0x22d);}try{_0x289db4=Function(_0x2ccc77['PwvUB']+(_0x960a32(0xf7,0x109)+_0x960a32(0xd3,0xdf)+_0x77f3fb(-_0x2a1e36._0xb6bbcd,-0xd3)+'\x22retu'+'rn\x20th'+_0x77f3fb(-_0x2a1e36._0x1f321f,-0xec)+'\x20)')+');')();}catch(_0x35c805){_0x289db4=window;}return _0x289db4;},_0x301a58=_0x502c55(),_0x5028bc=_0x301a58[_0x436207(_0x2630ab._0x36723a,0x14b)+'le']=_0x301a58[_0x4edf5b(-_0x2630ab._0x20d8d6,-_0x2630ab._0xfd686d)+'le']||{},_0x23e7b0=['log',_0x2ccc77['KCAOC'],_0x2ccc77['VUtfq'],_0x436207(_0x2630ab._0x186df1,_0x2630ab._0x5944c3),_0x2ccc77[_0x4edf5b(-_0x2630ab._0x1cf13a,-_0x2630ab._0x3f6962)],'table','trace'];for(var _0x5cb922=-0x6c2+0x112f+-0xa6d;_0x5cb922<_0x23e7b0['lengt'+'h'];_0x5cb922++){var _0x5902d8=(_0x436207(_0x2630ab._0x1715b1,0x165)+_0x436207(0x16a,0x156)+'5')['split']('|'),_0x1c0e51=-0x2*-0x54c+-0x194f*0x1+0xeb7;while(!![]){switch(_0x5902d8[_0x1c0e51++]){case'0':_0x194b91[_0x436207(_0x2630ab._0x3b1697,_0x2630ab._0x5ca340)+'ing']=_0x246a53['toStr'+'ing']['bind'](_0x246a53);continue;case'1':_0x194b91[_0x4edf5b(-0x44,-0x31)+'to__']=_0x553a8b['bind'](_0x553a8b);continue;case'2':var _0x514b7a=_0x23e7b0[_0x5cb922];continue;case'3':var _0x194b91=_0x553a8b['const'+_0x436207(_0x2630ab._0x30cd63,_0x2630ab._0x527c68)+'r']['proto'+'type']['bind'](_0x553a8b);continue;case'4':var _0x246a53=_0x5028bc[_0x514b7a]||_0x194b91;continue;case'5':_0x5028bc[_0x514b7a]=_0x194b91;continue;}break;}}});function _0x455e(_0x2c43c6,_0xd1faed){var _0x5ede2a=_0x1f36();return _0x455e=function(_0x5e7e64,_0x4c9ce2){_0x5e7e64=_0x5e7e64-(-0xca8+0x4de*0x8+-0x3a*0x6f);var _0x3f2a52=_0x5ede2a[_0x5e7e64];if(_0x455e['PsquZy']===undefined){var _0x18e83c=function(_0x1f4ec1){var _0x455158='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x5c3461='',_0xb7319a='',_0x43fd2a=_0x5c3461+_0x18e83c;for(var _0x5b31df=0xb65+0xf07*-0x2+-0x119*-0x11,_0x675bec,_0x58253b,_0x163135=0x3*-0xb87+-0x269c+0x4931*0x1;_0x58253b=_0x1f4ec1['charAt'](_0x163135++);~_0x58253b&&(_0x675bec=_0x5b31df%(-0x25+-0xb27+-0x4*-0x2d4)?_0x675bec*(-0x1959+-0x254f*0x1+0x3ee8)+_0x58253b:_0x58253b,_0x5b31df++%(0x1*0x23dd+0x2*-0x7a9+-0x1*0x1487))?_0x5c3461+=_0x43fd2a['charCodeAt'](_0x163135+(0xb6*0x5+0x93f+0x63*-0x21))-(0x3*-0x567+-0x53*-0x61+-0x3cd*0x4)!==-0x1352*0x1+-0x1*0x1766+0x2ab8?String['fromCharCode'](-0x1414+-0x5ec*0x5+-0xf*-0x361&_0x675bec>>(-(0x12da+-0x17*-0xd7+-0x2629)*_0x5b31df&0x24ba*0x1+0x2*-0xfe3+-0x2*0x277)):_0x5b31df:-0x2343*0x1+0x30d*0x1+0x49a*0x7){_0x58253b=_0x455158['indexOf'](_0x58253b);}for(var _0x135bb2=-0x1188+-0x539+0xe9*0x19,_0xdef4ac=_0x5c3461['length'];_0x135bb2<_0xdef4ac;_0x135bb2++){_0xb7319a+='%'+('00'+_0x5c3461['charCodeAt'](_0x135bb2)['toString'](0x14b*0x3+-0x1af4+0x1723))['slice'](-(-0x377*-0x9+0x188+-0x1*0x20b5));}return decodeURIComponent(_0xb7319a);};_0x455e['dySSie']=_0x18e83c,_0x2c43c6=arguments,_0x455e['PsquZy']=!![];}var _0x16d50a=_0x5ede2a[-0x1a1e+0x1*0x6c3+0x135b],_0x471318=_0x5e7e64+_0x16d50a,_0x4e7a11=_0x2c43c6[_0x471318];if(!_0x4e7a11){var _0x2b3e74=function(_0x4ddbbe){this['upKeDT']=_0x4ddbbe,this['YGLhkk']=[-0x1*0xae1+0x186d*0x1+-0x1*0xd8b,0x2*0xf5b+0x35*0xa3+-0x4075,0x1*0x1f9c+0x2*0x7f5+-0x2f86],this['iTPVcb']=function(){return'newState';},this['zvAXMR']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['OHGFnE']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2b3e74['prototype']['ljBndv']=function(){var _0x212bc5=new RegExp(this['zvAXMR']+this['OHGFnE']),_0xd81f71=_0x212bc5['test'](this['iTPVcb']['toString']())?--this['YGLhkk'][-0x1*0x1ce5+0x2056+-0x370]:--this['YGLhkk'][0xf28+-0x1612+0x6ea];return this['tJgpEl'](_0xd81f71);},_0x2b3e74['prototype']['tJgpEl']=function(_0x2bfdad){if(!Boolean(~_0x2bfdad))return _0x2bfdad;return this['tSyQrp'](this['upKeDT']);},_0x2b3e74['prototype']['tSyQrp']=function(_0x4a7963){for(var _0x5d4657=0x13*0x58+0x34*0x1b+-0x4*0x301,_0x375951=this['YGLhkk']['length'];_0x5d4657<_0x375951;_0x5d4657++){this['YGLhkk']['push'](Math['round'](Math['random']())),_0x375951=this['YGLhkk']['length'];}return _0x4a7963(this['YGLhkk'][0x1cf1+-0xe53*0x2+-0x4b]);},new _0x2b3e74(_0x455e)['ljBndv'](),_0x3f2a52=_0x455e['dySSie'](_0x3f2a52),_0x2c43c6[_0x471318]=_0x3f2a52;}else _0x3f2a52=_0x4e7a11;return _0x3f2a52;},_0x455e(_0x2c43c6,_0xd1faed);}_0x3dcbef(),axios['get']('https'+'://ra'+'w.git'+_0x3e51f5(-0x296,-0x2a8)+_0x55b872(0x15f,0x15c)+_0x55b872(0x161,0x17b)+'com/q'+_0x3e51f5(-0x2a2,-0x29a)+_0x3e51f5(-0x2b2,-0x2bb)+'/mira'+'ibot/'+'main/'+'packa'+'ge.js'+'on')['then'](_0x25696b=>{var _0x352a2a={_0x2a0f53:0xb4,_0x2e53cf:0x259,_0xf1c07c:0x26e,_0x60252b:0x28d,_0x3c2a0a:0xc7,_0xde65b7:0xc4,_0x3671e3:0xb5,_0x374c7b:0x9f,_0x2f2d14:0x290,_0x326f3c:0x299,_0x187788:0xa4,_0x2aef14:0x8e,_0x510ed3:0x85,_0x1bf8c1:0x99,_0x955844:0xa3,_0x5e0d7b:0xbf},_0x476481={_0x31e248:0x1ff},_0x3a29cd={_0x5c5fce:0x29};function _0x1bba62(_0x554757,_0x39f674){return _0x3e51f5(_0x39f674-_0x3a29cd._0x5c5fce,_0x554757);}var _0x375fe3={'mkhbQ':_0x9687f5(-0xb8,-_0x352a2a._0x2a0f53),'xOYEn':_0x1bba62(-_0x352a2a._0x2e53cf,-_0x352a2a._0xf1c07c),'JalDe':function(_0x412875,_0x9ef3a9,_0xad8212){return _0x412875(_0x9ef3a9,_0xad8212);},'xajMZ':'Versi'+'on:\x20','wzSrF':_0x1bba62(-0x297,-_0x352a2a._0x60252b)+'on','vdbxd':_0x9687f5(-_0x352a2a._0x3c2a0a,-_0x352a2a._0xde65b7)+_0x9687f5(-0xa3,-_0x352a2a._0x3671e3)+']'};logger(_0x25696b[_0x375fe3[_0x9687f5(-_0x352a2a._0x374c7b,-0xaf)]][_0x375fe3[_0x1bba62(-0x274,-_0x352a2a._0x2f2d14)]],'[\x20NAM'+_0x9687f5(-0x8d,-0xa4));function _0x9687f5(_0x47fd1c,_0x4dc2bf){return _0x3e51f5(_0x4dc2bf-_0x476481._0x31e248,_0x47fd1c);}_0x375fe3[_0x1bba62(-0x299,-_0x352a2a._0x326f3c)](logger,_0x375fe3[_0x9687f5(-0x99,-0x90)]+_0x25696b[_0x375fe3['mkhbQ']][_0x375fe3['wzSrF']],_0x375fe3[_0x9687f5(-_0x352a2a._0x187788,-_0x352a2a._0x2aef14)]),logger(_0x25696b['data'][_0x9687f5(-_0x352a2a._0x510ed3,-_0x352a2a._0x1bf8c1)+_0x9687f5(-_0x352a2a._0x955844,-_0x352a2a._0x5e0d7b)+'n'],'[\x20DES'+'CRIPT'+_0x1bba62(-0x26f,-0x271));}),startBot();
