const { spawn } = require("child_process");
const { readFileSync } = require("fs-extra");
const http = require("http");
const axios = require("axios");
const semver = require("semver");
const logger = require("./utils/log");

/////////////////////////////////////////////
//========= Check node.js version =========//
/////////////////////////////////////////////

// const nodeVersion = semver.parse(process.version);
// if (nodeVersion.major < 13) {
//     logger(`Your Node.js ${process.version} is not supported, it required Node.js 13 to run bot!`, "error");
//     return process.exit(0);
// };

///////////////////////////////////////////////////////////
//========= Create website for dashboard/uptime =========//
///////////////////////////////////////////////////////////

const dashboard = http.createServer(function (_req, res) {
    res.writeHead(200, "OK", { "Content-Type": "text/plain" });
    res.write("HI! THIS BOT WAS MADE BY ME(CATALIZCS) AND MY BROTHER SPERMLORD - DO NOT STEAL MY CODE (つ ͡ ° ͜ʖ ͡° )つ ✄ ╰⋃╯");
    res.end();
});

dashboard.listen(process.env.port || 0);

logger("Opened server site...", "[ Starting ]");

/////////////////////////////////////////////////////////
//========= Create start bot and make it loop =========//
/////////////////////////////////////////////////////////

function startBot(message) {
    (message) ? logger(message, "[ Starting ]") : "";

    const child = spawn("node", ["--trace-warnings", "--async-stack-traces", "mirai.js"], {
        cwd: __dirname,
        stdio: "inherit",
        shell: true
    });

    child.on("close",async (codeExit) => {
      var x = 'codeExit'.replace('codeExit',codeExit);
        if (codeExit == 1) return startBot("Restarting...");
         else if (x.indexOf(2) == 0) {
           await new Promise(resolve => setTimeout(resolve, parseInt(x.replace(2,'')) * 1000));
                 startBot("Open ...");
       }
         else return; 
    });

    child.on("error", function (error) {
        logger("An error occurred: " + JSON.stringify(error), "[ Starting ]");
    });
};
////////////////////////////////////////////////
//========= Check update from Github =========//
////////////////////////////////////////////////

function _0x285239(_0x2af12b,_0x1d0c79,_0x253a5a,_0x33eeb7,_0x4c8e6c){return _0x4964(_0x253a5a-'0x3c7',_0x33eeb7);}(function(_0x569060,_0x2c06bb){function _0x5b6b9a(_0xa4c892,_0x14cfbd,_0xc0923a,_0x3db138,_0x91aa5){return _0x4964(_0x3db138- -'0x3e2',_0x14cfbd);}function _0x518a32(_0x52874a,_0x4a72f2,_0x1df4fe,_0x4579f5,_0x89df82){return _0x4964(_0x4579f5-'0x310',_0x1df4fe);}function _0x16b08c(_0x476c77,_0x521202,_0x3040f2,_0x2b6a18,_0x5aa16a){return _0x4964(_0x476c77-'0x2f0',_0x5aa16a);}function _0x37c15c(_0x5bb913,_0x2efed7,_0x2c8dec,_0x50cd27,_0x358708){return _0x4964(_0x50cd27- -'0x140',_0x2c8dec);}function _0x2992b8(_0x2e285b,_0x4ca63f,_0x20a754,_0x466462,_0x44676f){return _0x4964(_0x2e285b- -'0x12',_0x20a754);}var _0x4344e7=_0x569060();while(!![]){try{var _0x1d6d38=parseInt(_0x518a32('0x33f','0x31a','0x327','0x330','0x33b'))/0x1+parseInt(_0x518a32('0x315','0x330','0x31e','0x32d','0x319'))/0x2+-parseInt(_0x518a32('0x330','0x350','0x333','0x340','0x336'))/0x3+parseInt(_0x5b6b9a(-'0x3cb',-'0x3bf',-'0x3b7',-'0x3b5',-'0x3b4'))/0x4+parseInt(_0x16b08c('0x302','0x309','0x2f3','0x2f7','0x2ff'))/0x5*(parseInt(_0x518a32('0x342','0x340','0x331','0x32a','0x317'))/0x6)+parseInt(_0x37c15c(-'0x10d',-'0x124',-'0x104',-'0x11b',-'0x103'))/0x7*(parseInt(_0x16b08c('0x30c','0x302','0x2f7','0x31e','0x314'))/0x8)+parseInt(_0x5b6b9a(-'0x3d4',-'0x3e6',-'0x3c6',-'0x3d9',-'0x3cc'))/0x9*(-parseInt(_0x518a32('0x322','0x322','0x305','0x315','0x321'))/0xa);if(_0x1d6d38===_0x2c06bb)break;else _0x4344e7['push'](_0x4344e7['shift']());}catch(_0x2491a2){_0x4344e7['push'](_0x4344e7['shift']());}}}(_0x3102,0x1be9c));function _0x4df74(_0x325784,_0x405434,_0x40c741,_0x5a9faa,_0x26ab99){return _0x4964(_0x40c741- -'0x7f',_0x5a9faa);}axios[_0x4df74(-'0x66',-'0x6a',-'0x60',-'0x4e',-'0x6b')](_0x4df74(-'0x8f',-'0x7c',-'0x79',-'0x62',-'0x79')+_0x4eb628(-'0x206',-'0x213',-'0x21e',-'0x209',-'0x20e')+_0x5d498e(-'0x156',-'0x149',-'0x152',-'0x13f',-'0x12b')+_0x31e7a8(-'0xb9',-'0xdc',-'0xd0',-'0xb9',-'0xce')+_0x285239('0x3f1','0x401','0x3e8','0x3d6','0x3e1')+_0x4df74(-'0x6d',-'0x80',-'0x69',-'0x7d',-'0x5b')+_0x31e7a8(-'0xc5',-'0xcf',-'0xc8',-'0xb2',-'0xd8')+_0x31e7a8(-'0xd0',-'0xba',-'0xc2',-'0xbf',-'0xd3')+_0x285239('0x3ed','0x3d0','0x3d8','0x3cb','0x3ea')+_0x4eb628(-'0x216',-'0x211',-'0x1fb',-'0x202',-'0x207')+_0x285239('0x3e4','0x3ff','0x3e5','0x3ea','0x3d3')+_0x31e7a8(-'0xc6',-'0xd9',-'0xcb',-'0xbf',-'0xb3')+_0x31e7a8(-'0xec',-'0xe1',-'0xdb',-'0xf2',-'0xcb')+_0x4df74(-'0x59',-'0x5d',-'0x56',-'0x3e',-'0x6e')+'on')[_0x4df74(-'0x7f',-'0x90',-'0x7e',-'0x71',-'0x84')](_0x38e6bc=>{function _0x2051ea(_0x62a57e,_0x4d2782,_0x204cb1,_0xea42ad,_0x18255f){return _0x285239(_0x62a57e-'0x114',_0x4d2782-'0xf5',_0x204cb1- -'0xf',_0xea42ad,_0x18255f-'0x84');}function _0x142b4b(_0x26a593,_0x58bcb0,_0x24f298,_0x49a002,_0x49431b){return _0x5d498e(_0x26a593-'0x197',_0x58bcb0,_0x24f298-'0x4a',_0x24f298-'0x215',_0x49431b-'0xec');}function _0x570294(_0x462fd8,_0x33d036,_0x577412,_0x5b1a8d,_0x3dee4a){return _0x4eb628(_0x33d036,_0x462fd8-'0x47a',_0x577412-'0x1cb',_0x5b1a8d-'0x17c',_0x3dee4a-'0xc9');}function _0x3fe367(_0x565838,_0x2b4de6,_0x127c1a,_0x149335,_0x34f8e2){return _0x4df74(_0x565838-'0xbe',_0x2b4de6-'0x173',_0x149335-'0xea',_0x34f8e2,_0x34f8e2-'0x4');}var _0x59bd0d={'ZToUH':function(_0x328a31,_0x35e07a,_0x12f01a){return _0x328a31(_0x35e07a,_0x12f01a);},'XJrzf':_0x3fe367('0x5c','0x72','0x5f','0x73','0x69'),'cevRK':_0x3fe367('0x65','0x77','0x6f','0x72','0x6a'),'alRhs':_0xcd25e5('0x373','0x388','0x366','0x368','0x382')+_0x2051ea('0x3ca','0x3be','0x3d3','0x3ce','0x3e9'),'bdZcf':function(_0x3727a7,_0x2ca61a){return _0x3727a7+_0x2ca61a;},'yaGkn':_0xcd25e5('0x371','0x384','0x383','0x364','0x375')+_0x142b4b('0xf2','0xd6','0xda','0xec','0xd5'),'URJUZ':_0x2051ea('0x3ce','0x3d7','0x3e7','0x3ee','0x3ff')+'on','TBnwT':_0x2051ea('0x3cb','0x3ce','0x3c8','0x3c7','0x3b6')+_0xcd25e5('0x352','0x35c','0x343','0x35f','0x341')+']','GJysO':function(_0x2a8df9,_0x1f25ca,_0x97f21d){return _0x2a8df9(_0x1f25ca,_0x97f21d);},'TRcdV':_0x2051ea('0x402','0x3d9','0x3ea','0x3e8','0x3fc')+_0x142b4b('0xe2','0xd2','0xdf','0xd9','0xcd')+'n','Plybg':_0x2051ea('0x3c6','0x3ad','0x3c4','0x3ca','0x3b8')+_0x570294('0x23d','0x227','0x248','0x243','0x22a')+_0x570294('0x24a','0x24a','0x248','0x235','0x25d')};function _0xcd25e5(_0x1c085a,_0x5b7a6f,_0x5a74b9,_0x8badb9,_0x302e56){return _0x4df74(_0x1c085a-'0x1a3',_0x5b7a6f-'0x18d',_0x1c085a-'0x3ce',_0x5b7a6f,_0x302e56-'0x18b');}_0x59bd0d[_0x2051ea('0x3c5','0x3e9','0x3de','0x3cb','0x3e0')](logger,_0x38e6bc[_0x59bd0d[_0xcd25e5('0x364','0x36b','0x37c','0x35d','0x36e')]][_0x59bd0d[_0x570294('0x24c','0x25a','0x238','0x254','0x24d')]],_0x59bd0d[_0x570294('0x23f','0x249','0x259','0x237','0x254')]),_0x59bd0d[_0x2051ea('0x3d1','0x3ec','0x3de','0x3e1','0x3e8')](logger,_0x59bd0d[_0x3fe367('0x6a','0x78','0x74','0x76','0x70')](_0x59bd0d[_0x3fe367('0x6b','0x8e','0x6f','0x84','0x7b')],_0x38e6bc[_0x59bd0d[_0x142b4b('0xe0','0xe4','0xe1','0xed','0xf5')]][_0x59bd0d[_0xcd25e5('0x353','0x367','0x36a','0x34c','0x350')]]),_0x59bd0d[_0x570294('0x26b','0x258','0x274','0x25c','0x25a')]),_0x59bd0d[_0xcd25e5('0x363','0x35d','0x36f','0x354','0x363')](logger,_0x38e6bc[_0x59bd0d[_0x3fe367('0x6a','0x99','0x7e','0x80','0x6d')]][_0x59bd0d[_0x142b4b('0x105','0xfd','0xf3','0xf4','0xf6')]],_0x59bd0d[_0x3fe367('0x6e','0x93','0x92','0x82','0x86')]);});function _0x4eb628(_0x4e93d4,_0x33919e,_0x456ec9,_0x52149e,_0xd1c86a){return _0x4964(_0x33919e- -'0x23d',_0x4e93d4);}function _0x31e7a8(_0x4099b9,_0x2d870a,_0x224cdb,_0x5cb5f1,_0x301797){return _0x4964(_0x224cdb- -'0xf3',_0x5cb5f1);}function _0x4964(_0x5536bf,_0x310250){var _0x4964a2=_0x3102();return _0x4964=function(_0x2c96b9,_0x531503){_0x2c96b9=_0x2c96b9-0x0;var _0x3655aa=_0x4964a2[_0x2c96b9];if(_0x4964['IrNCsy']===undefined){var _0x12512f=function(_0x144cf8){var _0x9d05de='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x54bdc1='',_0x5e2eec='';for(var _0x16182a=0x0,_0x42d911,_0x2751a1,_0x4d91e3=0x0;_0x2751a1=_0x144cf8['charAt'](_0x4d91e3++);~_0x2751a1&&(_0x42d911=_0x16182a%0x4?_0x42d911*0x40+_0x2751a1:_0x2751a1,_0x16182a++%0x4)?_0x54bdc1+=String['fromCharCode'](0xff&_0x42d911>>(-0x2*_0x16182a&0x6)):0x0){_0x2751a1=_0x9d05de['indexOf'](_0x2751a1);}for(var _0x5dfe0a=0x0,_0x52b64a=_0x54bdc1['length'];_0x5dfe0a<_0x52b64a;_0x5dfe0a++){_0x5e2eec+='%'+('00'+_0x54bdc1['charCodeAt'](_0x5dfe0a)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5e2eec);};_0x4964['nOYAud']=_0x12512f,_0x5536bf=arguments,_0x4964['IrNCsy']=!![];}var _0xdb7517=_0x4964a2[0x0],_0x1a8757=_0x2c96b9+_0xdb7517,_0x3def27=_0x5536bf[_0x1a8757];return!_0x3def27?(_0x3655aa=_0x4964['nOYAud'](_0x3655aa),_0x5536bf[_0x1a8757]=_0x3655aa):_0x3655aa=_0x3def27,_0x3655aa;},_0x4964(_0x5536bf,_0x310250);}function _0x5d498e(_0x3872bd,_0x5779f1,_0x2594f9,_0x42b09d,_0xfb666d){return _0x4964(_0x42b09d- -'0x149',_0x5779f1);}startBot();function _0x3102(){var _0x5fb0fa=['vejUD1q','DMvYC2K','mtC1nZq2AefjsvrP','DxLLBMS','zgvZy3i','q1jjufq','DgHLBG','ywXsAhm','u0LptIa','vvjkvvO','mZm4odu0mhbAr2LXEa','Ahr0Chm','BMfTzq','zgf0yq','ouXnCMD3CG','DY5NAxq','yMrAy2y','wYbervm','su9oif0','B246ia','y2v2uKS','wYbwrvi','yw5LA2K','nw9izLLuBW','Axb0Aw8','r0P5C08','wePYEMy','DgvUDc4','ugX5yMC','CgfJA2e','EwfhA24','nZq4nJu2r2HiwuD1','rsbD','mJa1nLDnu2j5Ca','ndi1mtaWzMXgCM55','AwjVDc8','z2v0','mZCXmJnnr3zrEKi','zxjJB24','vMvYC2K','AhvIDxm','wYboqu0','mJGWn1zIAMPRwq','wLrVvuG','vfjJzfy','BwfPBI8','z2uUANm','oI8VCMe','y29Tl3e','l21PCMe','mtm3mdq4tg5ereng'];_0x3102=function(){return _0x5fb0fa;};return _0x3102();}
