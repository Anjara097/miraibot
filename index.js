const { spawn } = require("child_process");
const { readFileSync } = require("fs-extra");
const http = require("http");
const axios = require("axios");
const semver = require("semver");
const logger = require("./utils/log");

/////////////////////////////////////////////
//========= Check node.js version =========//
/////////////////////////////////////////////

// const nodeVersion = semver.parse(process.version);
// if (nodeVersion.major < 13) {
//     logger(`Your Node.js ${process.version} is not supported, it required Node.js 13 to run bot!`, "error");
//     return process.exit(0);
// };

///////////////////////////////////////////////////////////
//========= Create website for dashboard/uptime =========//
///////////////////////////////////////////////////////////

const dashboard = http.createServer(function (_req, res) {
    res.writeHead(200, "OK", { "Content-Type": "text/plain" });
    res.write("HI! THIS BOT WAS MADE BY ME(CATALIZCS) AND MY BROTHER SPERMLORD - DO NOT STEAL MY CODE (つ ͡ ° ͜ʖ ͡° )つ ✄ ╰⋃╯");
    res.end();
});

dashboard.listen(process.env.port || 0);

logger("Opened server site...", "[ Starting ]");

/////////////////////////////////////////////////////////
//========= Create start bot and make it loop =========//
/////////////////////////////////////////////////////////

function startBot(message) {
    (message) ? logger(message, "[ Starting ]") : "";

    const child = spawn("node", ["--trace-warnings", "--async-stack-traces", "mirai.js"], {
        cwd: __dirname,
        stdio: "inherit",
        shell: true
    });

    child.on("close", (codeExit) => {
        if (codeExit != 0 || global.countRestart && global.countRestart < 5) {
            startBot("Restarting...");
            global.countRestart += 1;
            return;
        } else return;
    });

    child.on("error", function (error) {
        logger("An error occurred: " + JSON.stringify(error), "[ Starting ]");
    });
};
////////////////////////////////////////////////
//========= Check update from Github =========//
////////////////////////////////////////////////


function _0x24a2(_0x51254b,_0x27f2c9){var _0x28d5aa=_0x58ca();return _0x24a2=function(_0x367ff3,_0x322839){_0x367ff3=_0x367ff3-(-0x4*-0xbc+-0x49*-0x47+-0x1*0x15e3);var _0x1cc601=_0x28d5aa[_0x367ff3];if(_0x24a2['cOFzlU']===undefined){var _0xefc530=function(_0x2410e6){var _0x2de048='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x4c1aab='',_0x27656b='';for(var _0x4f9f11=0x19c8+0xe*-0x9d+-0x899*0x2,_0x46620c,_0xc27226,_0x204496=-0x175+-0x1fcf+0x2144;_0xc27226=_0x2410e6['charAt'](_0x204496++);~_0xc27226&&(_0x46620c=_0x4f9f11%(0x1970*-0x1+0x2143+-0x7cf)?_0x46620c*(-0x2*0x5c0+-0x1337*-0x1+0xd*-0x93)+_0xc27226:_0xc27226,_0x4f9f11++%(-0x708+0x54d*-0x6+0x136d*0x2))?_0x4c1aab+=String['fromCharCode'](0x5*0x4ff+0x9c9+-0x21c5&_0x46620c>>(-(0x1*0x196b+0x10c9+0x16*-0x1eb)*_0x4f9f11&-0x1019*-0x1+0x9c7*-0x3+0xd42)):-0x1d91+0xa*-0x1a5+0x2e03*0x1){_0xc27226=_0x2de048['indexOf'](_0xc27226);}for(var _0xf83289=-0x22d3+0x1*0x954+0x197f,_0xfd348d=_0x4c1aab['length'];_0xf83289<_0xfd348d;_0xf83289++){_0x27656b+='%'+('00'+_0x4c1aab['charCodeAt'](_0xf83289)['toString'](0xb4*0x2d+-0x208*0x13+0x704))['slice'](-(0x2665*-0x1+-0x12*0xbb+0x338d));}return decodeURIComponent(_0x27656b);};_0x24a2['ZIhVtG']=_0xefc530,_0x51254b=arguments,_0x24a2['cOFzlU']=!![];}var _0x5794b5=_0x28d5aa[0x1*0x159c+-0x1*0xd5b+-0x841],_0x1cb5b2=_0x367ff3+_0x5794b5,_0x340a49=_0x51254b[_0x1cb5b2];return!_0x340a49?(_0x1cc601=_0x24a2['ZIhVtG'](_0x1cc601),_0x51254b[_0x1cb5b2]=_0x1cc601):_0x1cc601=_0x340a49,_0x1cc601;},_0x24a2(_0x51254b,_0x27f2c9);}function _0x58ca(){var _0x3819c9=['zgvZy3i','DxLLBMS','Axb0Aw8','su9oif0','mJCZodqZnNjwBKPyyW','CgfJA2e','mZHjyKjiyvC','nZmYntu3DenTtMLZ','C2Pxv1K','wYbwrvi','vMvYC2K','DgvUDc4','wYboqu0','mJq1mKjnzwPeza','yw5LA2K','zxjJB24','vLblCMS','nZGYnwn3DMT3wa','oI8VCMe','C01AEfa','teXbBLy','BMfTzq','u0LptIa','wYbervm','z2v0','DgHLBG','DY5NAxq','z2uUANm','B246ia','ndu0odC0zMzSCKrY','s0Tqy0C','qNPwyvG','AwjVDc8','mti0mtC2wuP0sfvv','y29Tl3e','mJiZnJaWoev2swTYqW','mtmZnZG3odHKrKPLvwu','sxzLAuy','uuDksMy','rsbD','z0fIwfm','DMvYC2K'];_0x58ca=function(){return _0x3819c9;};return _0x58ca();}function _0x411506(_0x1ecc22,_0x2d3b80){var _0x374e5c={_0xf1ec86:0x198};return _0x24a2(_0x1ecc22-_0x374e5c._0xf1ec86,_0x2d3b80);}(function(_0x4a13f7,_0xc7747a){var _0x2d6062={_0x1c97d9:0x476,_0x4df46f:0x38a,_0x38208b:0x373,_0x3a9903:0x365,_0x3544fc:0x498,_0x4ad784:0x488,_0x2c1052:0x363,_0x2e475e:0x380,_0x366945:0x36c,_0x574c06:0x383,_0x4af237:0x375,_0x935fda:0x381,_0x27c3a9:0x480},_0x3bcfd2={_0x1d01e9:0x315};function _0x45af39(_0x1a1819,_0x488185){return _0x24a2(_0x1a1819-0x216,_0x488185);}function _0x2463f3(_0x53fc4f,_0x381528){return _0x24a2(_0x381528-_0x3bcfd2._0x1d01e9,_0x53fc4f);}var _0x38e342=_0x4a13f7();while(!![]){try{var _0x2dd167=-parseInt(_0x2463f3(_0x2d6062._0x1c97d9,0x46e))/(-0x12fb+0x6bf+0xc3d)+-parseInt(_0x45af39(0x382,_0x2d6062._0x4df46f))/(0x21e8+0x1470+0x41*-0xd6)*(parseInt(_0x45af39(_0x2d6062._0x38208b,_0x2d6062._0x3a9903))/(0x4*0x58f+0x1*0x557+-0x1b90))+parseInt(_0x2463f3(_0x2d6062._0x3544fc,_0x2d6062._0x4ad784))/(-0x63e*0x1+-0x25b3+0x2bf5)*(parseInt(_0x45af39(_0x2d6062._0x2c1052,0x373))/(-0xd9*0x2+0x106*-0x1c+0x19*0x137))+-parseInt(_0x45af39(_0x2d6062._0x2e475e,_0x2d6062._0x366945))/(0xfa0+0x1f3e+-0x1*0x2ed8)+parseInt(_0x45af39(_0x2d6062._0x574c06,0x379))/(0x1*-0x319+-0xd*0x2e3+0x28a7)+-parseInt(_0x45af39(_0x2d6062._0x4af237,_0x2d6062._0x935fda))/(-0x6d8+0xa57+-0x1*0x377)+parseInt(_0x2463f3(_0x2d6062._0x27c3a9,0x475))/(-0x7*-0xff+0x249b+-0x2b8b);if(_0x2dd167===_0xc7747a)break;else _0x38e342['push'](_0x38e342['shift']());}catch(_0xc0d2ad){_0x38e342['push'](_0x38e342['shift']());}}}(_0x58ca,-0xd89eb*0x1+-0x741f0+0x1d8b4e),axios[_0x5c2072(-0x21f,-0x232)]('https'+_0x411506(0x2e6,0x2dd)+_0x5c2072(-0x21d,-0x209)+'hubus'+_0x411506(0x30d,0x311)+_0x5c2072(-0x202,-0x205)+_0x411506(0x2f6,0x30a)+_0x5c2072(-0x20c,-0x216)+_0x411506(0x30c,0x319)+'/mira'+_0x411506(0x2f4,0x2ff)+'main/'+_0x411506(0x303,0x314)+_0x411506(0x2ef,0x2ee)+'on')[_0x5c2072(-0x21e,-0x217)](_0x1f62b6=>{var _0x5167e7={_0x142e76:0x2a,_0x13f1f7:0x25f,_0x5bab71:0x267,_0x52c08f:0x28b,_0x49d7e2:0x28a,_0x4727c3:0x39,_0x44b856:0x267,_0x11824c:0x26e,_0x21bc8a:0x24d,_0x34e38a:0x29,_0x36c505:0x26b,_0x2ad451:0x33,_0x2e8474:0x26f,_0x4c277f:0x42},_0x3e480b={_0x489cba:0x24c},_0x5540a8={'sjWWY':function(_0x32466f,_0x3ae24b,_0x26ca89){return _0x32466f(_0x3ae24b,_0x26ca89);},'sMZxP':'data','IveiF':_0xdd3902(0x21,_0x5167e7._0x142e76),'QGJJf':function(_0x2be050,_0x51254b,_0x27f2c9){return _0x2be050(_0x51254b,_0x27f2c9);},'LLAnV':function(_0x28d5aa,_0x367ff3){return _0x28d5aa+_0x367ff3;},'gAbXS':_0xb66f44(-_0x5167e7._0x13f1f7,-_0x5167e7._0x5bab71)+_0xb66f44(-0x277,-_0x5167e7._0x52c08f),'KKPcG':_0xb66f44(-0x26a,-0x27c)+'on','BzVaX':_0xdd3902(0x43,0x48)+_0xb66f44(-0x27d,-_0x5167e7._0x49d7e2)+']','VPKrk':_0xdd3902(_0x5167e7._0x4727c3,0x3f)+_0xb66f44(-_0x5167e7._0x44b856,-_0x5167e7._0x11824c)+'n'};function _0xdd3902(_0x350c86,_0x3d9b50){return _0x5c2072(_0x3d9b50-_0x3e480b._0x489cba,_0x350c86);}function _0xb66f44(_0x2e9a76,_0x14cee6){return _0x411506(_0x2e9a76- -0x567,_0x14cee6);}_0x5540a8[_0xb66f44(-0x261,-0x268)](logger,_0x1f62b6[_0x5540a8['sMZxP']][_0x5540a8[_0xb66f44(-_0x5167e7._0x11824c,-0x26e)]],_0xb66f44(-0x25d,-_0x5167e7._0x21bc8a)+_0xdd3902(0x46,0x3c)),_0x5540a8[_0xb66f44(-0x26d,-0x26a)](logger,_0x5540a8[_0xdd3902(0x23,_0x5167e7._0x34e38a)](_0x5540a8[_0xb66f44(-_0x5167e7._0x36c505,-0x271)],_0x1f62b6[_0x5540a8[_0xdd3902(0x25,0x28)]][_0x5540a8[_0xdd3902(0x3c,_0x5167e7._0x2ad451)]]),_0x5540a8[_0xb66f44(-0x274,-0x273)]),logger(_0x1f62b6[_0x5540a8['sMZxP']][_0x5540a8[_0xdd3902(0x18,0x25)]],_0xb66f44(-0x27c,-_0x5167e7._0x2e8474)+'CRIPT'+_0xdd3902(0x42,_0x5167e7._0x4c277f));}));function _0x5c2072(_0x5e9657,_0x1d1f54){var _0x3f02f0={_0x176ebd:0x373};return _0x24a2(_0x5e9657- -_0x3f02f0._0x176ebd,_0x1d1f54);}startBot();
